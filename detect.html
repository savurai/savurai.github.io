<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Detector</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: black;
}
nav {
    background: #111;
    padding: 15px;
    position: absolute;
    width: 100%;
    z-index: 10;
}
nav a {
    color: white;
    margin: 0 20px;
    font-size: 18px;
    text-decoration: none;
}
nav a:hover {
    color: #00ff88;
}

#video {
    position: absolute;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
}

#canvas {
    position: absolute;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
}
</style>

</head>
<body>

<nav>
    <a href="index.html">Home</a>
    <a href="detect.html">Detector</a>
    <a href="about.html">About</a>
</nav>

<video id="video" autoplay muted playsinline></video>
<canvas id="canvas"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// Roboflow API
const API_KEY = "rl4raGRK85cElw7CtZQI";
const MODEL_ID = "my-first-project-lmqc4/5";

// Start camera
async function startCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
    });
    video.srcObject = stream;

    video.onloadedmetadata = () => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
    };
}
startCamera();

// Draw boxes
function draw(preds) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.lineWidth = 3;
    ctx.font = "18px Arial";

    preds.forEach(p => {
        const left = p.x - p.width/2;
        const top = p.y - p.height/2;

        ctx.strokeStyle = "lime";
        ctx.strokeRect(left, top, p.width, p.height);

        ctx.fillStyle = "lime";
        ctx.fillText(
            `${p.class} (${(p.confidence*100).toFixed(1)}%)`,
            left + 4,
            top + 4
        );
    });
}

async function detect() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const image = canvas.toDataURL("image/jpeg");

    const res = await fetch(
        `https://detect.roboflow.com/${MODEL_ID}?api_key=${API_KEY}`,
        {
            method: "POST",
            body: image.split(",")[1]
        }
    );

    let data = await res.json();
    if (data.predictions) draw(data.predictions);

    requestAnimationFrame(detect);
}

video.onplaying = () => detect();
</script>

</body>
</html>
