<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Roboflow Webcam Detection</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #121212;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    video, canvas {
        margin-top: 20px;
        border-radius: 10px;
        background: black;
    }
</style>
</head>
<body>

<h2>Roboflow Live Object Detection</h2>

<video id="video" width="640" height="480" autoplay muted></video>
<canvas id="canvas" width="640" height="480"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// ---------------------
// 1. Start webcam
// ---------------------
async function startCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({
        video: { width: 640, height: 480 }
    });
    video.srcObject = stream;
}
startCamera();

// ---------------------
// 2. Roboflow Info
// ---------------------
const ROBOFLOW_API_KEY = "rl4raGRK85cElw7CtZQI";
const MODEL_ID = "my-first-project-lmqc4/5"
;   // example: my-first-project-abc/3

// ---------------------
// 3. Send frame to Roboflow
// ---------------------
async function runModel() {
    ctx.drawImage(video, 0, 0, 640, 480);

    const imgData = canvas.toDataURL("image/jpeg");

    const res = await fetch(
        `https://detect.roboflow.com/${MODEL_ID}?api_key=${ROBOFLOW_API_KEY}`,
        {
            method: "POST",
            body: imgData.split(",")[1], // remove header
        }
    );

    const json = await res.json();
    drawBoxes(json);

    requestAnimationFrame(runModel);
}

// ---------------------
// 4. Draw bounding boxes
// ---------------------
function drawBoxes(data) {
    ctx.drawImage(video, 0, 0, 640, 480);

    if (!data.predictions) return;

    data.predictions.forEach(pred => {
        ctx.beginPath();
        ctx.strokeStyle = "lime";
        ctx.lineWidth = 3;
        ctx.rect(
            pred.x - pred.width / 2,
            pred.y - pred.height / 2,
            pred.width,
            pred.height
        );
        ctx.stroke();

        ctx.fillStyle = "lime";
        ctx.font = "18px Arial";
        ctx.fillText(
            `${pred.class} (${Math.round(pred.confidence * 100)}%)`,
            pred.x - pred.width / 2,
            pred.y - pred.height / 2 - 10
        );
    });
}

// Start inference when the video is ready
video.onplaying = () => runModel();

</script>
</body>
</html>

